<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Admin â€“ Benutzerverwaltung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #2b7a2b;
      --primary-dark: #256b25;
      --bg: #f4f4f4;
      --white: #fff;
      --text: #333;
      --shadow: 0 0 10px rgba(0,0,0,0.1);
      --radius: 10px;
      --transition: all 0.2s ease-in-out;
    }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 2em;
      color: var(--text);
    }
    .admin-panel {
      max-width: 800px;
      margin: auto;
      background: var(--white);
      border-radius: var(--radius);
      padding: 2em;
      box-shadow: var(--shadow);
    }
    h2, h3 {
      text-align: center;
      color: var(--primary);
    }
    form input,
    form select {
      padding: 0.5em;
      margin: 0.5em 0;
      border: 1px solid #ccc;
      border-radius: var(--radius);
      width: 100%;
    }
    form button,
    form input[type="submit"] {
      background: var(--primary);
      color: white;
      padding: 0.5em 1em;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: bold;
      transition: var(--transition);
    }
    form button:hover,
    form input[type="submit"]:hover {
      background: var(--primary-dark);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1em;
    }
    th, td {
      padding: 0.75em;
      border-bottom: 1px solid #ccc;
      text-align: left;
    }
    .flash {
      text-align: center;
      color: red;
      margin-bottom: 1em;
    }
    .logout-link {
      text-align: center;
      margin-top: 2em;
    }
    .logout-link a {
      color: var(--primary);
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h2>Benutzerverwaltung (Admin)</h2>
  <div class="admin-panel">

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash">
          {% for msg in messages %}<p>{{ msg }}</p>{% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <h3>âž• Neuen Benutzer erstellen</h3>
    <form method="post">
      <input type="hidden" name="action" value="create">
      <input type="text" name="username" placeholder="Benutzername" required>
      <input type="password" name="password" placeholder="Passwort" required>
      <input type="submit" value="Benutzer erstellen">
    </form>

    <h3>ðŸ“‹ Bestehende Benutzer verwalten</h3>
    <table>
      <thead>
        <tr><th>Benutzername</th><th>Aktionen</th></tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.username }}</td>
          <td>
            {% if user.username != 'admin' %}
              <form method="post" style="display:inline;">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="username" value="{{ user.username }}">
                <button type="submit">LÃ¶schen</button>
              </form>
              <form method="post" style="display:inline;">
                <input type="hidden" name="action" value="update_password">
                <input type="hidden" name="username" value="{{ user.username }}">
                <input type="password" name="password" placeholder="Neues Passwort" required>
                <button type="submit">Passwort Ã¤ndern</button>
              </form>
            {% else %}
              <em>Admin geschÃ¼tzt</em>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <h3>ðŸ“¤ CSV-Upload fÃ¼r Baumdaten</h3>
    <form method="post" enctype="multipart/form-data">
      <input type="hidden" name="action" value="upload_csv">
      <label for="username">Benutzer auswÃ¤hlen:</label>
      <select name="username" required>
        {% for user in users %}<option value="{{ user.username }}">{{ user.username }}</option>{% endfor %}
      </select>
      <label for="csvfile">CSV-Datei auswÃ¤hlen:</label>
      <input type="file" name="csvfile" accept=".csv" required>
      <input type="submit" value="CSV hochladen">
    </form>

    <div class="logout-link">
      <a href="{{ url_for('logout') }}">Abmelden</a>
    </div>
  </div>
</body>
</html>